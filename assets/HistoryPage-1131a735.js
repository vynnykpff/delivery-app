import{G as C,j as s,r as u,Z as y,A as g,$ as p,a0 as H,P as x,E as m,a1 as I,a2 as v,D as k,a3 as A}from"./index-3260ee99.js";import{S as f}from"./setNumberFormat-0bd9990e.js";import{H as S,a as U,b as D,c as F,d as $,e as w,O as B,f as E,g as h,h as P,i as R,j as b,k as z,C as M}from"./Order.styled-c2f7ac9e.js";import{M as O,G as W,g as G}from"./getCollectionRef-27752ac2.js";import{ap as N}from"./ModalWindow.styled-06c9a9b3.js";import"./NoData.module-4f41915b.js";function T(e){return C({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"}},{tag:"path",attr:{d:"M11 11h2v6h-2zm0-4h2v2h-2z"}}]})(e)}const L=({name:e,image:a,price:o,count:n})=>s.jsxs(S,{children:[s.jsx(U,{src:a}),s.jsxs(D,{children:[s.jsx(F,{children:e}),s.jsxs($,{children:["Count: ",n]}),s.jsx(w,{children:f("ru-RU",{style:"currency",currency:"UAH"},o*n)})]})]}),V=({data:e})=>s.jsxs(s.Fragment,{children:[s.jsx(B,{children:"Info about order"}),s.jsxs(E,{children:[s.jsxs(h,{children:["name: ",e.userName]}),s.jsxs(h,{children:["email: ",e.userEmail]}),s.jsxs(h,{children:["phone: ",e.userPhone]}),s.jsxs(h,{children:["address: ",`${e.userFrom} / ${e.userWhere}`]})]})]}),Z=({collectionOrders:e})=>{const[a,o]=u.useState(!1),[n,l]=u.useState(null),i=y("isAuth"),d=g(),r=t=>{console.log(t),l(t),o(!0)};return s.jsx(s.Fragment,{children:i?s.jsx("div",{style:{marginTop:40},children:e&&e.map(t=>s.jsxs(P,{children:[s.jsx(R,{children:s.jsx("span",{style:{fontWeight:700},children:`${t.data.date+" /"} ${t.data.time}`})}),s.jsx(T,{style:{fontSize:28,position:"absolute",top:20,right:20,cursor:"pointer"},onClick:()=>r(t.data)}),s.jsx(b,{children:t.order.map(c=>s.jsx(L,{...c},c.id))}),s.jsxs(z,{children:["Total price:"," ",s.jsx("span",{style:{fontWeight:700},children:f("ru-RU",{style:"currency",currency:"UAH"},t.data.totalPrice)})]}),s.jsx(O,{active:a,setActive:o,children:s.jsxs(s.Fragment,{children:[s.jsx(N,{onClick:()=>o(!1),children:s.jsx(W,{})}),n&&s.jsx(V,{data:n})]})})]},t.id))}):d("/login")})},q=async(e,a)=>await p(G(e,a)),ss=()=>{const[e,a]=u.useState([]),o=g();u.useEffect(()=>{(async()=>{var i,d;try{const r=H(y("userId"));if(x.currentUser||r){const t=(d=(i=x)==null?void 0:i.currentUser)==null?void 0:d.uid,c=await q(m,`orders-${t||r}`);a(c.docs.map(j=>({...j.data(),id:j.id})))}}catch{I("isAuth"),o(v)}})()},[]);const n=async()=>{var r,t;const l=(t=(r=x)==null?void 0:r.currentUser)==null?void 0:t.uid,i=k(m,`orders-${l}`);(await p(i)).forEach(async c=>{await A(c.ref)})};return s.jsxs(s.Fragment,{children:[s.jsx(Z,{collectionOrders:e}),e&&s.jsx(M,{onClick:n,children:"Clear history"})]})};export{ss as default};
